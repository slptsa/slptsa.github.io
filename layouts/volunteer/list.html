{{ define "main" }}
<div class="volunteer-page">

  <!-- Page Intro -->
  <section class="page-intro">
    <div class="container">
      <div class="intro-content">
        {{ .Content }}
      </div>
    </div>
  </section>

  <!-- Volunteer Opportunities from Events -->
  <section class="volunteer-section">
    <div class="container">

      <h2 class="section-title">PTSA Event Volunteers</h2>

      {{ $events := .Site.Data.events.upcoming }}
      {{ $now := now }}

      {{ if $events }}

      <!-- Filter to only show future events that need volunteers -->
      {{ $volunteerEvents := slice }}
      {{ range $events }}
        {{ if and .date .volunteers_needed }}
          {{ $eventDate := time .date }}
          {{ $isUpcoming := false }}

          {{ if and .multi_day .end_date }}
            <!-- For multi-day events, check if end date is in the future -->
            {{ $endDate := time .end_date }}
            {{ if ge $endDate $now }}
              {{ $isUpcoming = true }}
            {{ end }}
          {{ else }}
            <!-- For single-day events, check if start date is in the future -->
            {{ if ge $eventDate $now }}
              {{ $isUpcoming = true }}
            {{ end }}
          {{ end }}

          {{ if $isUpcoming }}
            {{ $volunteerEvents = $volunteerEvents | append . }}
          {{ end }}
        {{ end }}
      {{ end }}

      {{ if $volunteerEvents }}
      <div class="volunteer-events-cards-grid">
        {{ range $volunteerEvents }}
        {{ $eventDate := time .date }}

        <div class="volunteer-event-card">
          <div class="volunteer-event-card-header">
            <div class="event-date-badge">
              {{ if and .multi_day .end_date }}
                {{ $endDate := time .end_date }}
                <span class="date-range">{{ $eventDate.Format "Jan 2" }} - {{ $endDate.Format "Jan 2" }}</span>
              {{ else }}
                <div class="date-badge-content">
                  <span class="month">{{ $eventDate.Format "Jan" }}</span>
                  <span class="day">{{ $eventDate.Format "02" }}</span>
                </div>
              {{ end }}
            </div>
            <div class="event-title-area">
              <h3>{{ .title }}</h3>
              {{ if .category }}
              <span class="event-category category-{{ .category }}">{{ .category }}</span>
              {{ end }}
            </div>
          </div>

          <div class="volunteer-event-card-body">
            <div class="event-meta-info">
              <p class="event-time">
                <strong>‚è∞ Time:</strong> {{ .time }}
              </p>
              <p class="event-location">
                <strong>üìç Location:</strong> {{ .location }}
              </p>
            </div>
            {{ if .description }}
            <p class="event-description">{{ .description }}</p>
            {{ end }}
          </div>

          <div class="volunteer-event-card-actions">
            {{ if .volunteer_link }}
            <a href="{{ .volunteer_link }}" target="_blank" class="btn-volunteer-signup">
              üôã Sign Up to Volunteer
            </a>
            {{ else }}
            <p class="no-signup-yet">Sign-up link coming soon!</p>
            {{ end }}
          </div>
        </div>
        {{ end }}
      </div>
      {{ else }}
      <div class="no-opportunities">
        <p>No volunteer opportunities available at this time. Check back soon!</p>
        <p>In the meantime, you can <a href="{{ "/join/" | relURL }}">join the PTSA</a> or <a href="{{ "/events/" | relURL }}">view all upcoming events</a>.</p>
      </div>
      {{ end }}

      {{ else }}
      <div class="no-opportunities">
        <p>No events data available.</p>
      </div>
      {{ end }}

    </div>
  </section>

  <!-- Open PTSA Positions -->
  <section class="open-positions-section">
    <div class="container">

      <h2 class="section-title">Open Spots on the PTSA</h2>
      <p class="section-intro">Join our team! We have openings on our PTSA board and committees. Help make a difference for our students.</p>

      {{ $positions := .Site.Data.volunteer.positions }}

      {{ if $positions }}

      <!-- Filter to only show active positions -->
      {{ $activePositions := slice }}
      {{ range $positions }}
        {{ if .active }}
          {{ $activePositions = $activePositions | append . }}
        {{ end }}
      {{ end }}

      {{ if $activePositions }}
      <div class="position-cards-grid">
        {{ range $activePositions }}

        <div class="position-card">
          <div class="position-card-header">
            <h3>{{ .title }}</h3>
          </div>

          <div class="position-card-body">
            <p class="position-description">{{ .description }}</p>

            <div class="position-details">
              <p class="position-commitment">
                <strong>‚è±Ô∏è Time Commitment:</strong> {{ .commitment }}
              </p>
              <p class="position-term">
                <strong>üìÖ Term:</strong> {{ .term }}
              </p>
            </div>
          </div>

          <div class="position-card-actions">
            {{ if .contact_email }}
            <a href="mailto:{{ .contact_email }}" class="btn-position-apply">
              ‚úâÔ∏è Express Interest
            </a>
            {{ else }}
            <a href="mailto:{{ $.Site.Params.email }}" class="btn-position-apply">
              ‚úâÔ∏è Express Interest
            </a>
            {{ end }}
          </div>
        </div>

        {{ end }}
      </div>
      {{ else }}
      <div class="no-positions">
        <p>No open positions at this time. Check back soon or contact us to learn about future opportunities!</p>
      </div>
      {{ end }}

      {{ else }}
      <div class="no-positions">
        <p>No positions data available.</p>
      </div>
      {{ end }}

    </div>
  </section>

</div>
{{ end }}
