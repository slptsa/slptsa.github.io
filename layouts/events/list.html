{{ define "main" }}
<div class="events-page">

  <section class="events-section">
    <div class="container">
      
      {{ $events := .Site.Data.events.upcoming }}
      {{ $now := now }}
      
      {{ if $events }}
      
      <!-- Group events by month -->
      {{ $eventsByMonth := dict }}
      {{ range $events }}
        {{ if .date }}
          {{ $eventDate := time .date }}
          {{ $isUpcoming := false }}

          {{ if and .multi_day .end_date }}
            <!-- For multi-day events, check if end date is in the future -->
            {{ $endDate := time .end_date }}
            {{ if ge $endDate $now }}
              {{ $isUpcoming = true }}
            {{ end }}
          {{ else }}
            <!-- For single-day events, check if start date is in the future -->
            {{ if ge $eventDate $now }}
              {{ $isUpcoming = true }}
            {{ end }}
          {{ end }}

          {{ if $isUpcoming }}
            {{ $monthKey := $eventDate.Format "2006-01" }}
            {{ $monthEvents := index $eventsByMonth $monthKey | default slice }}
            {{ $monthEvents = $monthEvents | append . }}
            {{ $eventsByMonth = merge $eventsByMonth (dict $monthKey $monthEvents) }}
          {{ end }}
        {{ end }}
      {{ end }}
      
      {{ if $eventsByMonth }}
      {{ range $monthKey, $monthEvents := $eventsByMonth }}
        {{ $firstEvent := index $monthEvents 0 }}
        {{ $monthDate := time $firstEvent.date }}

        <div class="month-section">
          <h2 class="month-header">{{ $monthDate.Format "January 2006" }}</h2>

          <div class="events-cards-grid">
            {{ range $monthEvents }}
            {{ $eventDate := time .date }}

            <div class="event-card {{ if .multi_day }}multi-day{{ end }}">
              <div class="event-card-header">
                <div class="event-date-badge">
                  {{ if and .multi_day .end_date }}
                    {{ $endDate := time .end_date }}
                    <span class="date-range">{{ $eventDate.Format "Jan 2" }} - {{ $endDate.Format "Jan 2" }}</span>
                  {{ else }}
                    <div class="date-badge-content">
                      <span class="month">{{ $eventDate.Format "Jan" }}</span>
                      <span class="day">{{ $eventDate.Format "02" }}</span>
                    </div>
                  {{ end }}
                </div>
                <div class="event-title-area">
                  <h3>{{ .title }}</h3>
                  {{ if .category }}
                  <span class="event-category category-{{ .category }}">{{ .category }}</span>
                  {{ end }}
                </div>
              </div>

              <div class="event-card-body">
                <div class="event-meta-info">
                  <p class="event-time">
                    <strong>‚è∞ Time:</strong> {{ .time }}
                  </p>
                  <p class="event-location">
                    <strong>üìç Location:</strong> {{ .location }}
                  </p>
                </div>
                {{ if .description }}
                <p class="event-description">{{ .description }}</p>
                {{ end }}
              </div>

              <div class="event-card-actions">
                {{ if .zoom_meeting }}
                  {{ if .zoom_link }}
                  <a href="{{ .zoom_link }}" target="_blank" class="btn-event-action btn-zoom">
                    üîó Join Zoom Meeting
                  </a>
                  {{ end }}
                {{ end }}

                {{ if .volunteers_needed }}
                  {{ if .volunteer_link }}
                  <a href="{{ .volunteer_link }}" target="_blank" class="btn-event-action btn-volunteer">
                    üôã Volunteer Sign Up
                  </a>
                  {{ end }}
                {{ end }}
              </div>
            </div>
            {{ end }}
          </div>
        </div>
      {{ end }}
      {{ else }}
      <p class="no-events">No upcoming events at this time. Check back soon!</p>
      {{ end }}
      
      {{ else }}
      <p class="no-events">No upcoming events at this time. Check back soon!</p>
      {{ end }}
      
    </div>
  </section>

</div>
{{ end }}
